{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar color_1 = require(\"@vibrant/color\");\nvar vbox_1 = __importDefault(require(\"./vbox\"));\nvar pqueue_1 = __importDefault(require(\"./pqueue\"));\nvar fractByPopulations = 0.75;\nfunction _splitBoxes(pq, target) {\n  var lastSize = pq.size();\n  while (pq.size() < target) {\n    var vbox = pq.pop();\n    if (vbox && vbox.count() > 0) {\n      var _a = vbox.split(),\n        vbox1 = _a[0],\n        vbox2 = _a[1];\n      pq.push(vbox1);\n      if (vbox2 && vbox2.count() > 0) pq.push(vbox2);\n      // No more new boxes, converged\n      if (pq.size() === lastSize) {\n        break;\n      } else {\n        lastSize = pq.size();\n      }\n    } else {\n      break;\n    }\n  }\n}\nvar MMCQ = function (pixels, opts) {\n  if (pixels.length === 0 || opts.colorCount < 2 || opts.colorCount > 256) {\n    throw new Error('Wrong MMCQ parameters');\n  }\n  var vbox = vbox_1.default.build(pixels);\n  var colorCount = vbox.histogram.colorCount;\n  var pq = new pqueue_1.default(function (a, b) {\n    return a.count() - b.count();\n  });\n  pq.push(vbox);\n  // first set of colors, sorted by population\n  _splitBoxes(pq, fractByPopulations * opts.colorCount);\n  // Re-order\n  var pq2 = new pqueue_1.default(function (a, b) {\n    return a.count() * a.volume() - b.count() * b.volume();\n  });\n  pq2.contents = pq.contents;\n  // next set - generate the median cuts using the (npix * vol) sorting.\n  _splitBoxes(pq2, opts.colorCount - pq2.size());\n  // calculate the actual colors\n  return generateSwatches(pq2);\n};\nfunction generateSwatches(pq) {\n  var swatches = [];\n  while (pq.size()) {\n    var v = pq.pop();\n    var color = v.avg();\n    var r = color[0],\n      g = color[1],\n      b = color[2];\n    swatches.push(new color_1.Swatch(color, v.count()));\n  }\n  return swatches;\n}\nexports.default = MMCQ;","map":{"version":3,"names":["color_1","require","vbox_1","__importDefault","pqueue_1","fractByPopulations","_splitBoxes","pq","target","lastSize","size","vbox","pop","count","_a","split","vbox1","vbox2","push","MMCQ","pixels","opts","length","colorCount","Error","default","build","histogram","a","b","pq2","volume","contents","generateSwatches","swatches","v","color","avg","r","g","Swatch","exports"],"sources":["../../../../packages/vibrant-quantizer-mmcq/src/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}